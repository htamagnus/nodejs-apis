# Projeto NodeJS com Mongoose 
Mongoose √© um biblioteca de Modelagem de Dados de Objeto (ou ODM, do ingl√™s: Object Data Modeling) para MongoDB e Node.js. Ele gerencia o relacionamento entre dados, fornece a valida√ß√£o de esquemas e √© usado como tradutor entre objetos no c√≥digo e a representa√ß√£o desses objetos no MongoDB.

O MongoDB √© um banco de dados de documentos NoSQL que n√£o possui esquemas. Isso significa que ele guarda documentos JSON e que a estrutura deles pode variar, j√° que n√£o h√° a estrutura r√≠gida igual a dos bancos SQL. Uma das vantagens em usar NoSQL √© que acelera o desenvolvimento de aplica√ß√µes e reduz a complexidade das implementa√ß√µes.

---
## T√≥picos: 
1. [Conex√£o com o banco](#1¬∫-conex√£o-com-o-banco) üåê
2. [Definir um esquema](#2¬∫-definir-um-esquema) üìã
3. [Exportar um modelo](#3¬∫-exportar-um-modelo) üöö
4. [Buscando um produto](#4¬∫-buscando-um-produto) üîé
5. [Atualizando um produto](#5¬∫-atualizando-um-produto) ‚ú®
6. [Deletando um produto](#6¬∫-deletando-um-produto) üóëÔ∏è
7. [Relacionando Schemas](#7¬∫-relacionando-schemas) ‚ÜîÔ∏è
---

## 1¬∫: Conex√£o com o banco
~~~javascript
const mongoose = require("mongoose"); // O primeiro passo √© importar o m√≥dulo mongoose, ele fornece uma camada de abstra√ß√£o para simplificar a intera√ß√£o com o MongoDB.

mongoose
  .connect(
    "mongodb+srv://hta:agatha@cluster0.r2eb6bu.mongodb.net/shop?retryWrites=true&w=majority"
  ) // Esta linha estabelece uma conex√£o com o banco de dados MongoDB
  .then((result) => {
    app.listen(3006);
  }) //  Este bloco √© executado quando a conex√£o com o banco de dados √© estabelecida com sucesso. A fun√ß√£o app.listen(3006) inicia o servidor da aplica√ß√£o na porta 3007. 
  .catch((err) => {
    console.log(err);
  }); //  Se ocorrer algum erro durante a conex√£o com o banco de dados, este bloco √© executado. O erro √© capturado e registrado no console 
~~~

---

## 2¬∫: Definir um esquema:
O esquema define as propriedades do documento atrav√©s de um objeto, onde o nome da chave corresponde ao nome da propriedade na cole√ß√£o.
Os seguintes tipos de esquemas s√£o permitidos:
- Array
- Boolean (ou booleano, em portugu√™s)
- Buffer
- Date (ou formato de data, em portugu√™s)
- Mixed (um tipo gen√©rico/flex√≠vel de dados)
- Number (ou num√©rico, em portugu√™s)
- ObjectId
- String
~~~javascript
const mongoose = require('mongoose'); // Importa o m√≥dulo Mongoose, que √© necess√°rio para criar modelos e interagir com bancos de dados MongoDB

const Schema = mongoose.Schema; // Armazenamos a classe schema do mongoose na vari√°vel 'Schema'

const productSchema = new Schema({ //Criamos um novo esquema para representar a estrutura dos documentos que ser√£o armazenados em uma cole√ß√£o do MOngoDB. O objeto passado para o construtor do Schema define os campos e suas propriedades.
    title: {
        type: String,
        required: true
    },
    price: {
        type: Number,
        required: true
    },
    description: {
        type: String,
        required: true
    }
});
~~~
Portanto, o productSchema descreve a estrutura dos documentos que representam produtos. Cada documento precisa ter um t√≠tulo, pre√ßo e descri√ß√£o, e esses campos devem conter os tipos de dados especificados. 
Agora, o productSchema pode ser usado para criar modelos de dados que se encaixam nesse esquema. Esses modelos s√£o usados para interagir com a cole√ß√£o no banco de dados MongoDB e realizar opera√ß√µes como criar, ler, atualizar e excluir documentos.

---

## 3¬∫: Exportar um modelo: 
~~~javascript
module.exports = mongoose.model('Product', productSchema);
~~~
Para exportar um modelo no mongoose, voc√™ define um nome para ele e indica o nome da entidade.
Essa linha de c√≥digo combina o esquema productSchema com o nome 'Product' para criar um modelo que representa documentos com a estrutura definida no esquema. Esse modelo pode ser usado para executar opera√ß√µes no banco de dados, como criar, ler, atualizar e excluir documentos na cole√ß√£o 'Product'. Ap√≥s essa exporta√ß√£o, o modelo 'Product' estar√° dispon√≠vel para uso em outros arquivos e partes do seu aplicativo Node.js.

---

## 4¬∫: Buscando um produto:
~~~javascript
exports.getProducts = (req, res, next) => {
  Product.find()
    .then((products) => {
      res.render("shop/product-list", {
        prods: products,
        pageTitle: "All Products",
        path: "/products",
      });
    })
    .catch((err) => {
      console.log(err);
    });
};
~~~
O m√©todo find() do Mongoose √© uma das opera√ß√µes mais comuns e fundamentais para recuperar documentos de um banco de dados MongoDB. Ele √© usado para consultar documentos em uma cole√ß√£o com base em crit√©rios de pesquisa e retorna um ou mais documentos que correspondem a esses crit√©rios. Essa chamada procura todos os documentos no banco de dados MongoDB associados ao modelo Product.

---

## 5¬∫: Atualizando um produto: 
~~~javascript
exports.postEditProduct = (req, res, next) => {
  const prodId = req.body.productId; //  Obt√©m o ID do produto a ser editado do corpo da solicita√ß√£o
  const updatedTitle = req.body.title;
  const updatedPrice = req.body.price;
  const updatedImageUrl = req.body.imageUrl;
  const updatedDesc = req.body.description;

  Product.findById(prodId) // Esta linha faz uma consulta ao banco de dados para localizar o produto com o ID especificado (prodId) usando o m√©todo findById() do modelo Product. Isso √© feito para recuperar o produto existente que ser√° atualizado.
    .then((product) => { // Se o produto for encontrado com sucesso, a fun√ß√£o dentro deste bloco .then() ser√° executada. Ela recebe o produto encontrado como argumento (representado pela vari√°vel product).
      product.title = updatedTitle;
      product.price = updatedPrice;
      product.description = updatedDesc;
      product.imageUrl = updatedImageUrl;
      return product.save(); // Ap√≥s a atualiza√ß√£o das propriedades do produto, a fun√ß√£o .save() √© chamada para salvar essas altera√ß√µes no banco de dados.
    })
    .then((result) => {
      console.log("UPDATED PRODUCT!");
      res.redirect("/admin/products");
    })
    .catch((err) => console.log(err)); // Se houver algum erro durante o processo de atualiza√ß√£o ou salvamento do produto, o erro ser√° capturado neste bloco .catch() e registrado no console.
};
~~~
Esse controlador √© respons√°vel por atualizar as informa√ß√µes de um produto no banco de dados com base nos dados enviados por um formul√°rio de edi√ß√£o. Ele primeiro localiza o produto pelo ID, atualiza suas propriedades e, em seguida, salva as altera√ß√µes no banco de dados. Se bem-sucedido, a resposta √© redirecionada para a p√°gina de administra√ß√£o de produtos; caso contr√°rio, qualquer erro √© registrado no console.

---

## 6¬∫: Deletando um produto: 
~~~javascript
exports.postDeleteProduct = (req, res, next) => {
  const prodId = req.body.productId; //Obt√©m o ID do produto que deve ser exclu√≠do a partir do corpo da solicita√ß√£o POST.
  Product.findByIdAndRemove(prodId) // Esta linha realiza a exclus√£o do produto com o ID fornecido (prodId) no banco de dados MongoDB. Ela utiliza o m√©todo findByIdAndRemove do modelo Mongoose Product para localizar e remover o documento correspondente no banco de dados com base no ID.
    .then(() => {
      console.log("DESTROYED PRODUCT");
      res.redirect("/admin/products");
    }) // Se a exclus√£o do produto for bem-sucedida, o c√≥digo dentro deste bloco .then() √© executado. Neste caso, ele imprime "DESTROYED PRODUCT" no console e, em seguida, redireciona o usu√°rio para a p√°gina "/admin/products".
    .catch((err) => console.log(err)); //Se ocorrer algum erro durante o processo de exclus√£o do produto, o erro √© capturado neste bloco .catch() e √© registrado no console.
};
~~~
Esta fun√ß√£o controladora √© usada para excluir um produto do banco de dados com base no ID do produto fornecido na solicita√ß√£o POST. Se a exclus√£o for bem-sucedida, uma mensagem √© registrada no console e o usu√°rio √© redirecionado para a p√°gina de administra√ß√£o de produtos. Se houver algum erro durante o processo de exclus√£o, o erro √© registrado no console.

---

## 7¬∫ Relacionando Schemas: 
O atributo ref √© usado em esquemas do Mongoose para estabelecer uma refer√™ncia entre diferentes cole√ß√µes em um banco de dados MongoDB. Ele √© particularmente √∫til quando voc√™ deseja criar relacionamentos ou associa√ß√µes entre documentos em cole√ß√µes diferentes.

~~~javascript
const Schema = mongoose.Schema;

const productSchema = new Schema({
    userId: {
        type: Schema.Types.ObjectId,
        ref: "User", // estabelece uma referencia ao uma diferente cole√ß√£o chamada User
        required: true
    }
});

module.exports = mongoose.model('Product', productSchema);
~~~
- O productSchema inclui um campo chamado userId, que √© um tipo Schema.Types.ObjectId e faz refer√™ncia √† cole√ß√£o 'User'. Isso significa que o valor desse campo ser√° o ID de um documento na cole√ß√£o 'User'.

~~~javascript
const Schema = mongoose.Schema;

const userSchema = new Schema({
  cart: {
    items: [
      {
        productId: {
          type: Schema.Types.ObjectId,
          ref: "Product",
          required: true,
        },
        quantity: { type: Number, required: true },
      },
    ],
  },
});
module.exports = mongoose.model("User", userSchema);
~~~
- Cada item do carrinho √© representado por um objeto que inclui o productId (que √© uma refer√™ncia √† cole√ß√£o 'Product') e a quantity (a quantidade do produto no carrinho).
- Isso permite que um usu√°rio tenha produtos em seu carrinho e que esses produtos sejam refer√™ncias a documentos da cole√ß√£o 'Product'. A rela√ß√£o entre os usu√°rios e os produtos √© estabelecida por meio do campo productId.

---
